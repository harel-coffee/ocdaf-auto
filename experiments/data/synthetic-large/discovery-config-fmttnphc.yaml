seed_everything: 10
trainer:
  accelerator: gpu
  strategy: auto
  devices: 1
  num_nodes: 0
  precision: 32-true
  logger:
    class_path: lightning.pytorch.loggers.WandbLogger
    init_args:
      name: null
      save_dir: .
      version: null
      offline: false
      dir: null
      id: null
      anonymous: null
      project: smart-trainer
      log_model: false
      experiment: null
      prefix: ''
      checkpoint_name: null
  callbacks:
  - class_path: ocd.training.callbacks.data_visualizer.DataVisualizer
    init_args:
      image_size: null
      show_functions_in_dag: true
      show_original_statistics_on_histograms: true
  - class_path: ocd.training.callbacks.phase_changer.PhaseChangerCallback
    init_args:
      starting_phase: maximization
      monitor_validation: false
      monitor_training: true
      maximization_epoch_limit: 100
      expectation_epoch_limit: 80
      patience: 15
      threshold: 0.0001
      cooldown: 200
      reset_optimizers: false
      reinitialize_weights_on_maximization: false
      log_onto_logger: true
  - class_path: ocd.training.callbacks.save_results.SavePermutationResultsCallback
    init_args:
      save_path: experiments/final_runs/sweeps/synthetic-small-parametric/smart-synthetic_big_SinPlusX_n25_seed0-2023-05-16-03-11-47
      save_every_n_epochs: null
      log_every_n_epochs: 5
      num_samples: 5000
      ordering_to_score_mapping: null
      causal_graph:
        class_path: networkx.DiGraph
        init_args:
          incoming_graph_data:
          - - 14
            - 11
          - - 14
            - 8
          - - 14
            - 16
          - - 14
            - 12
          - - 14
            - 18
          - - 14
            - 3
          - - 14
            - 24
          - - 14
            - 22
          - - 14
            - 4
          - - 14
            - 10
          - - 15
            - 7
          - - 15
            - 17
          - - 15
            - 3
          - - 15
            - 24
          - - 15
            - 22
          - - 15
            - 4
          - - 15
            - 10
          - - 15
            - 0
          - - 11
            - 7
          - - 11
            - 21
          - - 11
            - 12
          - - 11
            - 18
          - - 11
            - 19
          - - 11
            - 24
          - - 11
            - 13
          - - 11
            - 1
          - - 11
            - 10
          - - 7
            - 8
          - - 7
            - 9
          - - 7
            - 21
          - - 7
            - 18
          - - 7
            - 22
          - - 7
            - 13
          - - 7
            - 0
          - - 8
            - 17
          - - 8
            - 16
          - - 8
            - 23
          - - 8
            - 21
          - - 8
            - 2
          - - 8
            - 3
          - - 8
            - 1
          - - 8
            - 5
          - - 8
            - 20
          - - 8
            - 0
          - - 17
            - 16
          - - 17
            - 9
          - - 17
            - 12
          - - 17
            - 18
          - - 17
            - 24
          - - 17
            - 22
          - - 17
            - 13
          - - 17
            - 4
          - - 17
            - 10
          - - 16
            - 23
          - - 16
            - 9
          - - 16
            - 21
          - - 16
            - 3
          - - 16
            - 22
          - - 16
            - 6
          - - 23
            - 9
          - - 23
            - 21
          - - 23
            - 18
          - - 23
            - 24
          - - 23
            - 6
          - - 23
            - 10
          - - 23
            - 0
          - - 9
            - 21
          - - 9
            - 12
          - - 9
            - 24
          - - 9
            - 13
          - - 9
            - 10
          - - 9
            - 0
          - - 21
            - 12
          - - 21
            - 24
          - - 2
            - 18
          - - 2
            - 3
          - - 2
            - 24
          - - 2
            - 13
          - - 2
            - 20
          - - 12
            - 19
          - - 12
            - 6
          - - 18
            - 19
          - - 18
            - 3
          - - 18
            - 4
          - - 18
            - 10
          - - 19
            - 24
          - - 19
            - 6
          - - 19
            - 5
          - - 19
            - 10
          - - 19
            - 0
          - - 3
            - 1
          - - 24
            - 5
          - - 24
            - 20
          - - 24
            - 0
          - - 22
            - 6
          - - 22
            - 1
          - - 22
            - 4
          - - 22
            - 20
          - - 22
            - 0
          - - 13
            - 4
          - - 13
            - 5
          - - 13
            - 20
          - - 13
            - 0
          - - 6
            - 1
          - - 6
            - 20
          - - 4
            - 0
          - - 5
            - 10
          - - 5
            - 0
          - - 20
            - 10
      log_into_logger: true
      evaluation_metrics: null
      ignore_evaluation_metrics:
      - pc-shd
  fast_dev_run: false
  max_epochs: 1
  min_epochs: null
  max_steps: -1
  min_steps: null
  max_time: null
  limit_train_batches: null
  limit_val_batches: null
  limit_test_batches: null
  limit_predict_batches: null
  overfit_batches: 0.0
  val_check_interval: null
  check_val_every_n_epoch: 1
  num_sanity_val_steps: null
  log_every_n_steps: 1
  enable_checkpointing: true
  enable_progress_bar: false
  enable_model_summary: true
  accumulate_grad_batches: 1
  gradient_clip_val: null
  gradient_clip_algorithm: null
  deterministic: null
  benchmark: null
  inference_mode: true
  use_distributed_sampler: true
  profiler: null
  detect_anomaly: false
  barebones: false
  plugins: null
  sync_batchnorm: false
  reload_dataloaders_every_n_epochs: 0
  default_root_dir: null
data:
  class_path: lightning_toolbox.DataModule
  init_args:
    dataset: ocd.data.SyntheticOCDDataset
    dataset_args:
      standardization: true
      reject_outliers_n_far_from_mean: 5
      name: synthetic_big_SinPlusX_n25_seed0
      observation_size: 1000
      scm_generator: ocd.data.synthetic.ParametricSCMGenerator
      scm_generator_args:
        graph_generator: ocd.data.scm.GraphGenerator
        noise_parameters:
          loc:
          - 0.0
          - 0.0
          scale:
          - 1.0
          - 1.0
        noise_type: normal
        s_function:
          function_descriptor: "def func(x):\n  x[x < 100] = numpy.log(1 + numpy.exp(x[x\
            \ < 100]))\n  return x\n"
          function_of_interest: func
        s_function_signature: softplus
        t_function:
          function_descriptor: "def func(x):\n  return numpy.sin(x) + x\n"
          function_of_interest: func
        t_function_signature: sin_plus_x
        weight_s:
        - 0.5
        - 1.5
        weight_t:
        - 0.5
        - 1.5
        graph_generator_args:
          n: 25
          graph_type: erdos_renyi
          p: 0.4
          seed: 14
        seed: 13
      seed: 11
    train_dataset: null
    train_dataset_args: null
    val_size: 0.01
    val_dataset: null
    val_dataset_args: null
    test_dataset: null
    test_dataset_args: null
    transforms: null
    train_transforms: null
    val_transforms: null
    test_transforms: null
    batch_size: 128
    train_batch_size: null
    val_batch_size: null
    test_batch_size: null
    pin_memory: true
    train_pin_memory: null
    val_pin_memory: null
    test_pin_memory: null
    train_shuffle: true
    val_shuffle: false
    test_shuffle: false
    num_workers: 0
    train_num_workers: null
    val_num_workers: null
    test_num_workers: null
    seed: 0
    save_hparams: true
    initialize_superclass: true
model:
  class_path: ocd.training.module.OCDafTrainingModule
  init_args:
    maximization_specifics: null
    expectation_specifics: null
    grad_clip_val: 1.0
    phases:
    - maximization
    - expectation
    model: null
    model_cls: ocd.models.ocdaf.OCDAF
    model_args:
      use_permutation: true
      permutation_learner_cls: ocd.models.permutation.LearnablePermutation
      permutation_learner_args:
        gumbel_noise_std:
          code: "def func(self, training_module, **kwargs):\n  tot_epochs_on_exp =\
            \ 3200 / 180 * 80\n  step_size = 2.0 / tot_epochs_on_exp\n  if not hasattr(training_module,\
            \ 'last_std'):\n    training_module.last_std = 2.0\n  \n  # if you don't\
            \ have the epoch from before then assign it\n  if not hasattr(training_module,\
            \ 'last_epoch_std_sched'):\n    training_module.last_epoch_std_sched =\
            \ training_module.current_epoch\n  \n  if training_module.current_phase\
            \ != 'maximization' and training_module.last_epoch_std_sched != training_module.current_epoch:\n\
            \    training_module.last_std -= step_size\n  \n  training_module.last_epoch_std_sched\
            \ = training_module.current_epoch\n\n  return training_module.last_std\n"
          function_of_interest: func
        permutation_type: hybrid-sparse-map-simulator
        maximum_basis_size: 64
      base_distribution: torch.distributions.Normal
      base_distribution_args:
        loc: 0.0
        scale: 1.0
      layers:
      - 10
      - 30
      - 10
      populate_features: true
      layers_limit:
      - 100
      - 300
      - 50
      num_transforms: 1
      additive: false
      residual: false
      bias: true
      activation: torch.nn.LeakyReLU
      activation_args:
        negative_slope: 0.1
      in_features: 25
    objective: null
    objective_cls: lightning_toolbox.Objective
    objective_args:
      nll:
        code: "def func(training_module, batch):\n  t = training_module.forward(batch)\n\
          \  res = t['log_prob']\n  return -res.mean()\n"
        function_of_interest: func
    optimizer:
    - torch.optim.AdamW
    - torch.optim.AdamW
    optimizer_frequency: null
    optimizer_is_active:
    - 'lambda training_module: training_module.current_phase == ''maximization'' if
      hasattr(training_module, ''current_phase'') else True

      '
    - 'lambda training_module: training_module.current_phase == ''expectation'' if
      hasattr(training_module, ''current_phase'') else True

      '
    optimizer_parameters:
    - model.flow
    - model.permutation_model
    optimizer_args:
    - weight_decay: 0.1
    - weight_decay: 0.01
    lr:
    - 0.01
    - 0.01
    scheduler:
    - torch.optim.lr_scheduler.ReduceLROnPlateau
    - torch.optim.lr_scheduler.ReduceLROnPlateau
    scheduler_name:
    - lr_scheduler_maximization
    - lr_scheduler_expectation
    scheduler_optimizer:
    - 0
    - 1
    scheduler_args:
    - mode: min
      min_lr: 5.0e-05
      threshold: 0.001
      factor: 0.5
      patience: 140
    - mode: min
      min_lr: 0.0005
      threshold: 0.001
      factor: 0.5
      patience: 110
    scheduler_interval: epoch
    scheduler_frequency: 1
    scheduler_monitor:
    - loss
    - loss
    scheduler_strict: null
    save_hparams: true
    initialize_superclass: true
