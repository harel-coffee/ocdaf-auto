# This is a sweep on different phase changing strategies and how
# it can affect the training process for larger datasets
project: small-data-3,4,5,10-method-learn-order
checkpoint_interval: 30
default_root_dir: experiments/sweep
use_smart_trainer: True
agent_run_args:
  count: 128
sweep_configuration:
  method: grid
  metric:
    goal: minimize
    name: metrics/average-backward_relative_penalty
  parameters:
    trainer:
      callbacks:
        - class_path: ocd.training.callbacks.data_visualizer.DataVisualizer

    model:
      init_args:
        model_cls: ocd.models.ocdaf.OCDAF
        model_args:
          sweep_group_0:
            sweep_identifier: 4PermLearning
            sweep: True
            sweep_alias:
              - PermuteSimilarityTrick
              - PermuteSoft
              - PermuteHybridQuantization
            values:
              - use_permutation: True
                permutation_learner_cls: ocd.models.permutation.LearnablePermutation
                permutation_learner_args:
                  gumbel_noise_std: >
                    lambda self, training_module, **kwargs: 2 - (1.9 / (training_module.trainer.max_epochs)) * (training_module.current_epoch)
                  permutation_type: hybrid-sparse-map-simulator
              - use_permutation: True
                permutation_learner_cls: ocd.models.permutation.LearnablePermutation
                permutation_learner_args:
                  gumbel_noise_std: >
                    lambda self, training_module, **kwargs: 2 - (1.9 / (training_module.trainer.max_epochs)) * (training_module.current_epoch)
                  permutation_type: soft
              - use_permutation: True
                permutation_learner_cls: ocd.models.permutation.LearnablePermutation
                permutation_learner_args:
                  gumbel_noise_std: >
                    lambda self, training_module, **kwargs: 2 - (1.9 / (training_module.trainer.max_epochs)) * (training_module.current_epoch)
                  permutation_type: hybrid-quantization

    data:
      class_path: lightning_toolbox.DataModule
      init_args:
        dataset_args:
          sweep_group1:
            sweep_identifier: 3SCM
            sweep: True
            sweep_alias:
              - NonParam
              - Sin
              - Cube
            values:
              - scm_generator: ocd.data.synthetic.GaussianProcessBasedSCMGeberator
                scm_generator_args:
                  s_gamma_rbf_kernel: 1.0
                  s_mean_function_activation: { function_descriptor: "def func(x):\n    x[x\
                                      \ < 100] = numpy.log(1 + numpy.exp(x[x < 100]))\n    return x",
                                                function_of_interest: func }
                  s_mean_function_activation_signature: softplus
                  s_mean_function_weights: [ 0.01, 0.1 ]
                  s_variance_rbf_kernel: 1.0
                  t_mean_function_activation: { function_descriptor: "def func(x):\n    return\
                                      \ numpy.sin(x) + x", function_of_interest: func }
                  t_mean_function_activation_signature: sin_plus_x
                  t_mean_function_weights: [ 0.01, 0.1 ]
                  t_variance_rbf_kernel: 1.0
              - scm_generator: ocd.data.synthetic.ParametricSCMGenerator
                scm_generator_args:
                  noise_parameters:
                    loc: 0.0
                    scale: 1.0
                  noise_type: normal
                  s_function: { function_descriptor: "def func(x):\n    x[x < 100] = numpy.log(1\
                                \ + numpy.exp(x[x < 100]))\n    return x", function_of_interest: func }
                  s_function_signature: softplus
                  t_function: { function_descriptor: "def func(x):\n    return numpy.sin(x)\
                                      \ + x", function_of_interest: func }
                  t_function_signature: sin_plus_x
                  weight_s: [ 0.5, 1.5 ]
                  weight_t: [ 0.5, 1.5 ]
              - scm_generator: ocd.data.synthetic.ParametricSCMGenerator
                scm_generator_args:
                  noise_parameters:
                    loc: 0.0
                    scale: 1.0
                  noise_type: normal
                  s_function: { function_descriptor: "def func(x):\n    x[x < 100] = numpy.log(1\
                                \ + numpy.exp(x[x < 100]))\n    return x", function_of_interest: func }
                  s_function_signature: softplus
                  t_function: { function_descriptor: "def func(x):\n    x[x > 100] = 100\n\
                                      \    x[x < -100] = -100\n    x_mean = numpy.mean(x)\n    x_std\
                                      \ = numpy.std(x)\n    if x_std == 0:\n        x_std = 1\n    x\
                                      \ = (x - x_mean) / x_std\n    ret = x**3 + 7\n    return ret",
                                function_of_interest: func }
                  t_function_signature: cube_and_dislocate
                  weight_s: [ 0.5, 1.5 ]
                  weight_t: [ 0.5, 1.5 ]

          sweep_group_2:
            sweep_identifier: 2GraphType
            sweep: True
            sweep_alias:
              - Erdos                
              - Full
              - Chain
            values:
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: erdos_renyi
                    p: 0.65
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: full
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: chain

          sweep_group_3:
            sweep_identifier: 1NodeNum
            sweep: True
            sweep_alias:
              - three
              - ten
              - four
              - five
            values:
              - scm_generator_args:
                  graph_generator_args:
                    n: 3
                    enforce_ordering: [0, 1, 2]
              - scm_generator_args:
                  graph_generator_args:
                    n: 10
                    enforce_ordering: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
              - scm_generator_args:
                  graph_generator_args:
                    n: 4
                    enforce_ordering: [0, 1, 2, 3]
              - scm_generator_args:
                  graph_generator_args:
                    n: 5
                    enforce_ordering: [0, 1, 2, 3, 4]
         
    sweep_group_4:
      sweep_identifier: 0Seed
      sweep: True
      sweep_alias:
        - seed0
        - seed1
        - seed2
        - seed3
        - seed4
      values:
        - seed_everything: 3
          data:
            init_args:
              dataset_args:
                scm_generator_args:
                  seed: 1415
                  graph_generator_args:
                    seed: 9265
              seed: 3589
        - seed_everything: 7932
          data:
            init_args:
              dataset_args:
                scm_generator_args:
                  seed: 3846
                  graph_generator_args:
                    seed: 2643
              seed: 3832
        - seed_everything: 7950
          data:
            init_args:
              dataset_args:
                scm_generator_args:
                  seed: 2884
                  graph_generator_args:
                    seed: 1971
              seed: 6939
        - seed_everything: 9375
          data:
            init_args:
              dataset_args:
                scm_generator_args:
                  seed: 1058
                  graph_generator_args:
                    seed: 2097
              seed: 3
        - seed_everything: 4944
          data:
            init_args:
              dataset_args:
                scm_generator_args:
                  seed: 5923
                  graph_generator_args:
                    seed: 781
              seed: 6406


