# This is a sweep on different phase changing strategies and how
# it can affect the training process for larger datasets
project: small-data-sweep-method-epoch-enforce-order
checkpoint_interval: 30
default_root_dir: experiments/sweep
use_smart_trainer: True
agent_run_args:
  count: 128
sweep_configuration:
  method: grid
  metric:
    goal: minimize
    name: metrics/average-backward_relative_penalty
  parameters:
    trainer:
      callbacks:
        - class_path: ocd.training.callbacks.data_visualizer.DataVisualizer

    sweep_group_0:
      sweep_identifier: MaxEpoch-Scheduler
      sweep: True
      sweep_alias:
        - 1500-50
        - 3000-100
        - 6000-100
      values:
        - trainer:
            max_epochs: 1500
          model:
            init_args:
              scheduler_args:
                - patience: 50
                - patience: 50
        - trainer:
            max_epochs: 3000
          model:
            init_args:
              scheduler_args:
                - patience: 100
                - patience: 100
        - trainer:
            max_epochs: 6000
          model:
            init_args:
              scheduler_args:
                - patience: 100
                - patience: 100

    model:
      init_args:
        model_cls: ocd.models.ocdaf.OCDAF
        model_args:
          # sweep_group_0a:
          #   sweep_identifier: PermLearning
          #   sweep: True
          #   sweep_alias:
          #     - Truee
          #     - Falsee
          #   values:
          #     - use_permutation: True
          #     - use_permutation: False
          sweep_group_1:
            sweep_identifier: Permutation-Strategy
            sweep: True
            sweep_alias:
              - SimilarityTrick
              - Soft
              - straight-through
            values:
              - permutation_learner_args:
                  permutation_type: gumbel-topk
              - permutation_learner_args:
                  permutation_type: soft
              - permutation_learner_args:
                  permutation_type: straight-through
        sweep_group_2:
          sweep_identifier: WeightDecay
          sweep: True
          sweep_alias:
            - Large
            - Extra-Large
          values:
            - optimizer_args:
                - weight_decay: 0.5
                - weight_decay: 0.01
            - optimizer_args:
                - weight_decay: 1
                - weight_decay: 0.05

    data:
      class_path: lightning_toolbox.DataModule
      init_args:
        dataset_args:
          sweep_group3:
            sweep_identifier: SCM
            sweep: True
            sweep_alias:
              - NonParam
              - Sin
              - Cube
            values:
              - scm_generator: ocd.data.synthetic.GaussianProcessBasedSCMGeberator
                scm_generator_args:
                  s_gamma_rbf_kernel: 1.0
                  s_mean_function_activation:
                    { function_descriptor: "def func(x):\n    x[x\
                        \ < 100] = numpy.log(1 + numpy.exp(x[x < 100]))\n    return x", function_of_interest: func }
                  s_mean_function_activation_signature: softplus
                  s_mean_function_weights: [0.01, 0.1]
                  s_variance_rbf_kernel: 1.0
                  seed: 95
                  t_mean_function_activation:
                    { function_descriptor: "def func(x):\n    return\
                        \ numpy.sin(x) + x", function_of_interest: func }
                  t_mean_function_activation_signature: sin_plus_x
                  t_mean_function_weights: [0.01, 0.1]
                  t_variance_rbf_kernel: 1.0
                seed: 210
              - scm_generator: ocd.data.synthetic.ParametricSCMGenerator
                scm_generator_args:
                  noise_parameters:
                    loc: 0.0
                    scale: 1.0
                  noise_type: normal
                  s_function:
                    {
                      function_descriptor:
                        "def func(x):\n    x[x < 100] = numpy.log(1\
                        \ + numpy.exp(x[x < 100]))\n    return x",
                      function_of_interest: func,
                    }
                  s_function_signature: softplus
                  seed: 780
                  t_function:
                    {
                      function_descriptor:
                        "def func(x):\n    return numpy.sin(x)\
                        \ + x",
                      function_of_interest: func,
                    }
                  t_function_signature: sin_plus_x
                  weight_s: [0.5, 1.5]
                  weight_t: [0.5, 1.5]
                seed: 64
              - scm_generator: ocd.data.synthetic.ParametricSCMGenerator
                scm_generator_args:
                  noise_parameters:
                    loc: 0.0
                    scale: 1.0
                  noise_type: normal
                  s_function:
                    {
                      function_descriptor:
                        "def func(x):\n    x[x < 100] = numpy.log(1\
                        \ + numpy.exp(x[x < 100]))\n    return x",
                      function_of_interest: func,
                    }
                  s_function_signature: softplus
                  seed: 519
                  t_function:
                    {
                      function_descriptor:
                        "def func(x):\n    x[x > 100] = 100\n\
                        \    x[x < -100] = -100\n    x_mean = numpy.mean(x)\n    x_std\
                        \ = numpy.std(x)\n    if x_std == 0:\n        x_std = 1\n    x\
                        \ = (x - x_mean) / x_std\n    ret = x**3 + 7\n    return ret",
                      function_of_interest: func,
                    }
                  t_function_signature: cube_and_dislocate
                  weight_s: [0.5, 1.5]
                  weight_t: [0.5, 1.5]
                seed: 387

          sweep_group_4:
            sweep_identifier: GraphType
            sweep: True
            sweep_alias:
              - Erdos
              - Full
              - Chain
            values:
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: erdos_renyi
                    p: 0.65
                    seed: 873
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: full
                    seed: 873
              - scm_generator_args:
                  graph_generator: ocd.data.scm.GraphGenerator
                  graph_generator_args:
                    graph_type: chain
                    seed: 873

          sweep_group_5:
            sweep_identifier: NodeNum
            sweep: True
            sweep_alias:
              - three
              - ten
              - four
              - five
            values:
              - scm_generator_args:
                  graph_generator_args:
                    n: 3
                    enforce_ordering: [0, 1, 2]
              - scm_generator_args:
                  graph_generator_args:
                    n: 10
                    enforce_ordering: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
              - scm_generator_args:
                  graph_generator_args:
                    n: 4
                    enforce_ordering: [0, 1, 2, 3]
              - scm_generator_args:
                  graph_generator_args:
                    n: 5
                    enforce_ordering: [0, 1, 2, 3, 4]

    seed_everything: 42
