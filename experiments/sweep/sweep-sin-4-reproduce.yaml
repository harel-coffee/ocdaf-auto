# This is a sweep on different phase changing strategies and how
# it can affect the training process for larger datasets
project: sweep-sin-4-reproduce
checkpoint_interval: 30
default_root_dir: experiments/sweep
use_smart_trainer: True
agent_run_args:
  count: 128
sweep_configuration:
  method: grid
  metric:
    goal: minimize
    name: metrics/average-backward_relative_penalty
  parameters:
    trainer:
      callbacks:
        - class_path: ocd.training.callbacks.phase_changer.PhaseChangerCallback
          init_args:
            sweep_group_0:
              sweep_identifier: Patience
              sweep: True
              sweep_alias:
                - ExtLowPatience
                - LowPatience
                - MediumPatience
                - HighPatience
              values:
                
                  maximization_epoch_limit: 50
                  expectation_epoch_limit: 50
                  patience: 10
                  cooldown: 25
                
                  maximization_epoch_limit: 100
                  expectation_epoch_limit: 100
                  patience: 20
                  cooldown: 50
                
                  maximization_epoch_limit: 200
                  expectation_epoch_limit: 200
                  patience: 30
                  cooldown: 100
                
                  maximization_epoch_limit: 300
                  expectation_epoch_limit: 300
                  patience: 40
                  cooldown: 200
    model:
      init_args:
        sweep_group3:
          sweep_identifier: LR
          sweep: True
          sweep_alias:
            - Large-Large
            - Medium-Medium
            - Small-Small
            - Large-Small
            - Small-Large
          values:
            - lr: [ 0.05, 0.05 ]
            - lr: [ 0.01, 0.01 ]
            - lr: [ 0.005, 0.005 ]
            - lr: [ 0.05, 0.005 ]
            - lr: [ 0.005, 0.05 ]
        sweep_group4:
          sweep_identifier: Scheduling
          sweep: True
          sweep_alias:
            - Schedule-Fast
            - Schedule-Slow
            - No-Schedule
          values:
            - scheduler_args:
                - mode: min
                  factor: 0.5
                  patience: 50
                  min_lr: 0.00005
                  threshold: 0.001
                - mode: min
                  factor: 0.5
                  patience: 50
                  min_lr: 0.00005
                  threshold: 0.001
              scheduler:
                - ocd.training.schedulers.reduce_on_increase.ReduceLROnIncrease
                - ocd.training.schedulers.reduce_on_increase.ReduceLROnIncrease
              scheduler_name: [ "lr_scheduler_maximization", "lr_scheduler_expectation" ]
              scheduler_optimizer: [ 0, 1 ]
              scheduler_monitor: [ "loss", "loss" ]
            - scheduler_args:
                - mode: min
                  factor: 0.8
                  patience: 50
                  min_lr: 0.00005
                  threshold: 0.001
                - mode: min
                  factor: 0.8
                  patience: 50
                  min_lr: 0.00005
                  threshold: 0.001
              scheduler:
                - ocd.training.schedulers.reduce_on_increase.ReduceLROnIncrease
                - ocd.training.schedulers.reduce_on_increase.ReduceLROnIncrease
              scheduler_name: [ "lr_scheduler_maximization", "lr_scheduler_expectation" ]
              scheduler_optimizer: [ 0, 1 ]
              scheduler_monitor: [ "loss", "loss" ]
            - model_cls: ocd.models.ocdaf.OCDAF

        sweep_group5:
          sweep_identifier: weight_decay
          sweep: True
          sweep_alias:
            - small_decay
            - medium_decay
            - large_decay
          values:
            - optimizer_args:
                - weight_decay: 0.01
                - weight_decay: 0.05
            - optimizer_args:
                - weight_decay: 0.1
                - weight_decay: 0.1
            - optimizer_args:
                - weight_decay: 0.5
                - weight_decay: 0.1

    sweep_group_batch:
      sweep_identifier: Batch
      sweep: True
      sweep_alias:
        - Batch32
        - Batch128
      values:
        - data:
            init_args:
              batch_size: 32
        - data:
            init_args:
              batch_size: 128
